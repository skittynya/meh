<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MLBB Skin Collage — Manual Upload</title>
<style>
  :root{ --bg:#071020; --card:#071324; --muted:#9fb0c7; --accent:#60a5fa; }
  *{box-sizing:border-box}
  body{margin:0; min-height:100vh; font-family:system-ui,Segoe UI,Roboto,Arial; background:linear-gradient(180deg,#041025 0%,#07122a 100%); color:#eaf6ff; display:flex; align-items:flex-start; justify-content:center; padding:28px;}
  .wrap{width:100%; max-width:960px;}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:18px; border-radius:12px; border:1px solid rgba(255,255,255,0.03); box-shadow:0 10px 40px rgba(2,6,23,0.6);}
  h1{margin:0 0 8px 0; font-size:20px}
  p.lead{margin:6px 0 12px 0; color:var(--muted); font-size:13px}
  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .controls{display:flex; gap:12px; margin:14px 0 12px 0; align-items:center;}
  .btn{background:transparent; border:1px solid rgba(255,255,255,0.06); padding:10px 12px; border-radius:8px; color:inherit; cursor:pointer; font-weight:600;}
  .primary{background:linear-gradient(90deg,var(--accent),#7dd3fc); color:#062031; border:0}
  .small{padding:8px 10px; font-size:13px}
  .hint{font-size:13px; color:var(--muted)}
  .upload-area{margin-top:8px; display:grid; grid-template-columns:1fr 360px; gap:14px;}
  .left{padding:8px}
  .instructions{background:rgba(255,255,255,0.02); padding:12px; border-radius:8px; color:var(--muted); font-size:13px}
  .drop{border:2px dashed rgba(255,255,255,0.04); padding:18px; border-radius:8px; text-align:center; min-height:150px; display:flex; align-items:center; justify-content:center; color:var(--muted)}
  .drop.dragover{background:rgba(255,255,255,0.01); border-color:rgba(125,211,252,0.35)}
  .preview{display:grid; grid-template-columns:repeat(2,1fr); gap:8px; margin-top:12px}
  .slot{position:relative; overflow:hidden; border-radius:8px; background:rgba(255,255,255,0.02); height:0; padding-bottom:100%; display:flex; align-items:center; justify-content:center; color:var(--muted)}
  .slot img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover; display:block}
  canvas{display:block; margin:12px auto; max-width:100%; border-radius:8px}
  .foot{font-size:12px; color:var(--muted); margin-top:10px; text-align:center}
  label.file-btn{display:inline-block; cursor:pointer}
  input[type=file]{display:none}
  .meta{font-size:12px;color:var(--muted); margin-top:8px}
  @media(max-width:820px){
    .upload-area{grid-template-columns:1fr; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main">
      <h1>MLBB Skin Collage — Manual Upload</h1>
      <p class="lead">Upload up to <strong>4 screenshots or skin images</strong> and generate a 2×2 collage. Everything runs locally in your browser — nothing is uploaded to a server.</p>

      <div class="upload-area">
        <div class="left">
          <div id="dropzone" class="drop" title="Drag images here or click choose images">
            <div>
              <div style="font-weight:700;margin-bottom:6px">Drag & drop images here</div>
              <div class="hint">or click <label class="file-btn btn small primary" style="display:inline-block;margin:0 4px 0 4px">Choose Images<input id="fileinput" type="file" accept="image/*" multiple></label></div>
              <div class="meta">Tip: Upload full-screen profile/collection screenshots or 1-skin screenshots for best results.</div>
            </div>
          </div>

          <div class="preview" id="preview">
            <div class="slot" data-index="0">Slot 1</div>
            <div class="slot" data-index="1">Slot 2</div>
            <div class="slot" data-index="2">Slot 3</div>
            <div class="slot" data-index="3">Slot 4</div>
          </div>

          <div style="display:flex;gap:8px; margin-top:12px; flex-wrap:wrap">
            <button id="gen" class="btn primary small">Generate Collage</button>
            <a id="downloadBtn" class="btn small" style="display:none" download="collage.png">Download</a>
            <button id="clear" class="btn small">Clear</button>

            <div style="flex:1"></div>

            <label class="hint">Canvas size:
              <select id="size" style="margin-left:8px" class="btn small">
                <option value="600">600</option>
                <option value="800" selected>800</option>
                <option value="1000">1000</option>
              </select>
            </label>

            <label class="hint">Gap:
              <input id="gap" type="number" value="8" min="0" max="60" style="width:64px;margin-left:6px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit">
            </label>
          </div>

          <canvas id="canvas" width="800" height="800" style="display:none"></canvas>
          <div class="foot">Privacy: images stay in your browser. We do not upload or store anything.</div>
        </div>

        <div class="instructions">
          <strong>How to take MLBB screenshots (quick):</strong>
          <ol style="margin:8px 0 8px 18px; color:var(--muted)">
            <li><strong>Profile / Collection:</strong> Open player profile → collection / skins and take a full-screen screenshot (UID visible if you want verification).</li>
            <li><strong>Single skin screenshot:</strong> Go to hero, select skin, tap preview, take a screenshot (good for clean thumbnails).</li>
            <li><strong>Android:</strong> Volume Down + Power, or swipe gesture (varies by device).</li>
            <li><strong>iPhone:</strong> Side button + Volume Up (Face ID) or Side + Home (older models).</li>
            <li><strong>Crop (optional):</strong> You can crop before uploading for better composition but not required.</li>
          </ol>

          <div style="margin-top:8px">
            <strong>Usage flow (recommended):</strong>
            <ol style="margin:6px 0 0 18px; color:var(--muted)">
              <li>Take screenshots in-game</li>
              <li>Open this page on your phone or PC</li>
              <li>Upload up to 4 images (drag & drop or choose)</li>
              <li>Reorder by clicking a slot and selecting a new image</li>
              <li>Click <em>Generate Collage</em>, then <em>Download</em></li>
            </ol>
          </div>

          <div style="margin-top:12px; font-size:13px; color:var(--muted)">
            <strong>Notes:</strong>
            <ul style="margin:6px 0 0 18px;color:var(--muted)">
              <li>Works offline in your browser; images are never uploaded.</li>
              <li>If you want the collage to look consistent, use similar aspect screenshots.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // core logic: drag/drop, file load, preview, generate canvas, download
  const fileInput = document.getElementById('fileinput');
  const dropzone = document.getElementById('dropzone');
  const preview = document.getElementById('preview');
  const genBtn = document.getElementById('gen');
  const downloadBtn = document.getElementById('downloadBtn');
  const clearBtn = document.getElementById('clear');
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d', { alpha: false });
  const sizeSel = document.getElementById('size');
  const gapInput = document.getElementById('gap');

  // store up to 4 images
  const slots = [null, null, null, null];

  // create image from file
  function toImage(file){
    return new Promise((res, rej) => {
      const url = URL.createObjectURL(file);
      const img = new Image();
      img.onload = () => { URL.revokeObjectURL(url); res(img); };
      img.onerror = (e) => { URL.revokeObjectURL(url); rej(e); };
      img.src = url;
    });
  }

  // render preview
  function renderPreview(){
    preview.querySelectorAll('.slot').forEach(el => {
      const i = Number(el.dataset.index);
      el.innerHTML = '';
      if (slots[i]) {
        const img = document.createElement('img');
        img.src = slots[i].src;
        el.appendChild(img);
      } else {
        el.textContent = 'Slot ' + (i+1);
      }
    });
  }

  // accept files (max 4) - fill left to right
  async function handleFiles(list){
    const files = Array.from(list).filter(f => f.type && f.type.startsWith('image/')).slice(0,4);
    for (let i=0;i<files.length;i++){
      try {
        const img = await toImage(files[i]);
        slots[i] = img;
      } catch(e){ console.warn('file load err', e); }
    }
    renderPreview();
  }

  // file input
  fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

  // drag/drop
  dropzone.addEventListener('dragover', (ev) => { ev.preventDefault(); dropzone.classList.add('dragover'); });
  dropzone.addEventListener('dragleave', (ev) => { dropzone.classList.remove('dragover'); });
  dropzone.addEventListener('drop', (ev) => {
    ev.preventDefault();
    dropzone.classList.remove('dragover');
    handleFiles(ev.dataTransfer.files);
  });

  // click slot to replace
  preview.addEventListener('click', (ev) => {
    const slotEl = ev.target.closest('.slot');
    if (!slotEl) return;
    const idx = Number(slotEl.dataset.index);
    const picker = document.createElement('input');
    picker.type = 'file';
    picker.accept = 'image/*';
    picker.onchange = async (e) => {
      const f = e.target.files && e.target.files[0];
      if (!f) return;
      try {
        const img = await toImage(f);
        slots[idx] = img;
        renderPreview();
      } catch(err){ console.warn(err); }
    };
    picker.click();
  });

  // clear
  clearBtn.addEventListener('click', () => {
    for (let i=0;i<4;i++) slots[i] = null;
    fileInput.value = '';
    renderPreview();
    downloadBtn.style.display = 'none';
    canvas.style.display = 'none';
  });

  // generate collage (draw to canvas)
  genBtn.addEventListener('click', () => {
    const S = parseInt(sizeSel.value,10) || 800;
    const gap = Math.max(0, Math.min(60, Number(gapInput.value) || 8));
    canvas.width = S;
    canvas.height = S;
    // background
    ctx.fillStyle = '#071324';
    ctx.fillRect(0,0,S,S);
    // cell size: two cells plus gap between left and right
    const cell = Math.floor((S - gap) / 2);
    const pos = [
      {x:0, y:0},
      {x:cell + gap, y:0},
      {x:0, y:cell + gap},
      {x:cell + gap, y:cell + gap}
    ];
    // draw rounded background for the full collage (optional)
    // draw each slot
    for (let i=0;i<4;i++){
      const img = slots[i];
      const p = pos[i];
      // fill a neutral color for empty slots
      ctx.fillStyle = '#0b1220';
      ctx.fillRect(p.x, p.y, cell, cell);
      if (!img) continue;
      // cover-fit logic
      const iw = img.width, ih = img.height;
      const scale = Math.max(cell/iw, cell/ih);
      const w = iw * scale, h = ih * scale;
      const dx = p.x + (cell - w) / 2;
      const dy = p.y + (cell - h) / 2;
      ctx.drawImage(img, dx, dy, w, h);
    }
    // show and prepare download
    canvas.style.display = 'block';
    downloadBtn.style.display = 'inline-block';
    canvas.toBlob(blob => {
      const url = URL.createObjectURL(blob);
      downloadBtn.href = url;
    }, 'image/png');
  });

  // initial render
  renderPreview();
</script>
</body>
</html>
